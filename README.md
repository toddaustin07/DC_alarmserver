# SmartThings Direct-connected Devices for Alarmserver

This repository contains files to implement alarmserver on a Raspberry Pi with device applications using SmartThings direct-connected device API.  A device application will be instantiated for each DSC zone, plus a device application representing the DSC Panel.  Whereas in legacy SmartThings implementations, a separate Stay and Away panel was needed for automation linkage with SmartThings Home Monitor, here only one panel is needed.

Zones device apps can optionally display a GUI window on the Raspbery Pi desktop (one for each zone).  Alternatively they can be run in background with logfiles.
The panel application, in addition to handling the panel device interface to SmartThings, will also display a full DSC panel GUI window on the Pi desktop for local monitoring and control of the alarm system.

### Limitations
- Only one DSC partition is currently supported
- Smoke and Co2 zones has not been tested
- In the 'old' implementation of alarmserver, one nice thing was that the SmartThings devices were automatically generated by a smartapp.  Here they will need to be manaually defined in the Developer Workspace, and initially onboarded via the mobile app one at a time (a one-time setup task)

## Pre-requisites
- Direct-connect enablement github package for Raspberry Pi (rpi-st-device): https://toddaustin07.github.io/
- Installed and configured alarmserver package: https://github.com/rtorchia/DSC-Envisalink/tree/master/alarmserver
- SmartThings CLI:  https://github.com/SmartThingsCommunity/smartthings-cli/tree/master/packages/cli
- SmartThings personal token: https://smartthings.developer.samsung.com/docs/auth-and-permissions.html

## Automated Setup Tools

### ASdevsetup
Run this script using one argument as full pathname of your alarmserver.cfg file.  It will read your alarmserver.cfg file to get the defined zones and will then automate creation of device serial numbers and set up each zone device subdirectory with required files.  Note: this script depends on prior install and setup completion of rpi-st-device package.

### Device Onboarding Helper (wip)
Run this script once everything is configured & installed: ASdevsetup is complete, device projects are defined in Developer Workspace, and onboarding_config.json files have been downloaded.
This script will automate the creation of QR codes for each device and ensure everything is prepared for initial provisioning of all device apps (zone + panel)

### Additional scripts
startall - master startup script to load (1) zone device apps & panel (post initial onboarding), (2) DSCmanager, (3) alarmserver
buildloader - used by ASdevsetup; creates loaddevs script that loads/starts each device app (zones + panel)
STdevsn - list serial numbers associated with each device app


## Manual Setup Tasks

### Create SmartThings custom capabilities 
This will be done through either the CLI tool or via API with tools like Postman; all json is provided in this package.
This step can be eliminated if the Developer Workspace allowed using custom capabilities outside your own account.  At this time I don't think it does, but this requires confirmation.

### Create SmartThings device profiles
This is done in the Developer Workspace.  One project/device profile must be created for each TYPE of device you are using (panel, contact, motion, smoke, co2)
Recommended parameters to use in the Developer Workspace screens are as follows:
```
                               DSC Panel              Contact Device          Motion Device        
                               --------------------   --------------------    ---------------------
Device Profile
  Name                         DSC_Panel              DSC_Contact             DSC_Motion     
  Version                      0.1                    0.1                     0.1
  Device Type                  Switch                 ContactSensor           MotionSensor
  Components & Capabilities*   Health Check (opt)     Health Check (opt)      Health Check (opt)
                               partitionStatus        contactStatus           motionStatus
                               partitioncommand       zoneBypass              zonebypass
                               dscdashswitch
                               dscstayswitch
                               dscawayswitch
                               dscselectswitch
Onboarding
  Onboarding name                               <<  DSC Zone Device >>
  Authentication type                                << ED25519 >>
  Setup ID                                              << 02 >>
  Instructions                                  << whatever you'd like >>
Product Info
  Category                                           << WiFi/Hub >>
  Availability                                 << United States (or other) >>
  Model Number / SKU           DSC_PANEL001           DSC_CONTACT001           DSC_MOTION001

 
  
  UI Display*                         << 'Customize through device configuration file' >>

```

* These are custom capabilities (except Health Check); if/when we can specify custom capabilities from other accounts, my prefix is 'partyvoice23922'
** Upload the device configuration json file provided in this repository for the applicable device type:  deviceConfigST_panel.json, deviceConfigST_contact.json, deviceConfigST_motion.json

When complete with the above, onboarding_config.json files must be downloaded and placed in each of the appropriate device directories (one json file per device type)


2) Creation of SmartThings device profiles in the Developer Workspace: ONE for each device TYPE needed (types=panel, contact, motion, smoke, co2)
3) Download onboarding_config.json files into applicable zone device directories
4) Initial onboarding/provisioning of each zone device + panel device using mobile app

##
